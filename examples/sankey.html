<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Stunning Animated Sankey Diagram</title>
  <style>
    html, body { height: 100%; margin: 0; font-family: ui-sans-serif, system-ui, Arial; background: radial-gradient(120% 120% at 50% 0%, rgb(18,24,42) 0%, rgb(5,8,18) 60%); color: rgb(236,240,255); }
    .wrap { display: grid; grid-template-rows: auto 1fr; height: 100%; }
    .topbar { padding: 14px 18px; display: flex; gap: 14px; align-items: center; backdrop-filter: blur(8px); position: sticky; top: 0; z-index: 3; background: rgba(0,0,0,0.3); }
    .title { font-size: 18px; letter-spacing: 0.5px; opacity: 0.95; text-shadow: 0 0 6px rgba(255,255,255,0.3); }
    .btn { background: rgba(255,255,255,0.1); border: none; padding: 8px 12px; border-radius: 10px; color: white; cursor: pointer; }
    .btn:hover { background: rgba(255,255,255,0.18); }
    .stage { position: relative; overflow: hidden; display: flex; justify-content: center; align-items: center; }
    .tooltip { position: absolute; background: rgba(255,255,255,0.1); backdrop-filter: blur(10px); padding: 10px 14px; border-radius: 10px; color: #fff; font-size: 14px; pointer-events: none; opacity: 0; transition: opacity 0.3s ease, transform 0.2s ease; box-shadow: 0 4px 15px rgba(0,0,0,0.3); }
  </style>
</head>
<body>
  <div class="wrap">
    <div class="topbar">
      <div class="title">Stunning Animated Sankey Diagram</div>
      <button class="btn" id="shuffle">shuffle layout</button>
    </div>
    <div class="stage" id="stage">
      <div class="tooltip" id="tooltip"></div>
    </div>
  </div>

  <script src="https://unpkg.com/d3@7.9.0/dist/d3.min.js"></script>
  <script src="https://unpkg.com/d3-sankey@0.12.3/dist/d3-sankey.min.js"></script>
  <script>
    const width = window.innerWidth * 0.9;
    const height = window.innerHeight * 0.75;

    const svg = d3.select('#stage')
      .append('svg')
      .attr('width', width)
      .attr('height', height)
      .style('filter', 'drop-shadow(0px 0px 10px rgba(255,255,255,0.05))');

    const tooltip = d3.select('#tooltip');

    const color = d3.scaleSequential(d3.interpolateCool).domain([0, 10]);

    const sankey = d3.sankey()
      .nodeWidth(28)
      .nodePadding(22)
      .extent([[1, 1], [width - 1, height - 6]]);

    const { nodes, links } = buildData();
    const graph = sankey({ nodes: nodes.map(d => Object.assign({}, d)), links: links.map(d => Object.assign({}, d)) });

    const defs = svg.append('defs');
    graph.links.forEach((d, i) => {
      const grad = defs.append('linearGradient')
        .attr('id', `grad-${i}`)
        .attr('gradientUnits', 'userSpaceOnUse')
        .attr('x1', d.source.x1).attr('x2', d.target.x0);
      grad.append('stop').attr('offset', '0%').attr('stop-color', d3.interpolateCool(i / graph.links.length)).attr('stop-opacity', 0.9);
      grad.append('stop').attr('offset', '100%').attr('stop-color', d3.interpolatePlasma(i / graph.links.length)).attr('stop-opacity', 0.9);
    });

    const link = svg.append('g')
      .attr('fill', 'none')
      .selectAll('path')
      .data(graph.links)
      .join('path')
      .attr('d', d3.sankeyLinkHorizontal())
      .attr('stroke', (d, i) => `url(#grad-${i})`)
      .attr('stroke-opacity', 0.8)
      .attr('stroke-width', d => Math.max(1, d.width))
      .attr('class', 'link')
      .style('filter', 'drop-shadow(0px 0px 5px rgba(255,255,255,0.3))');

    link.each(function(_, i) {
      const path = d3.select(this);
      const length = this.getTotalLength();
      path.attr('stroke-dasharray', length)
        .attr('stroke-dashoffset', length)
        .transition()
        .duration(3000)
        .ease(d3.easeSinInOut)
        .attr('stroke-dashoffset', 0);
    });

    const node = svg.append('g')
      .selectAll('g')
      .data(graph.nodes)
      .join('g');

    node.append('rect')
      .attr('x', d => d.x0)
      .attr('y', d => d.y0)
      .attr('height', d => d.y1 - d.y0)
      .attr('width', d => d.x1 - d.x0)
      .attr('fill', (d, i) => color(i))
      .attr('stroke', (d, i) => d3.color(color(i)).darker(1.2))
      .attr('rx', 8)
      .attr('ry', 8)
      .style('filter', 'drop-shadow(0px 0px 8px rgba(255,255,255,0.2))')
      .on('mouseover', function(event, d) {
        d3.select(this).transition().duration(200).attr('stroke-width', 3).attr('stroke-opacity', 1);
        tooltip.style('opacity', 1).html(`<strong>${d.name}</strong><br/>Value: ${d.value}`)
          .style('left', (event.pageX + 8) + 'px')
          .style('top', (event.pageY - 28) + 'px');
      })
      .on('mousemove', event => tooltip.style('left', (event.pageX + 8) + 'px').style('top', (event.pageY - 28) + 'px'))
      .on('mouseout', function() {
        d3.select(this).transition().duration(200).attr('stroke-width', 1.5);
        tooltip.style('opacity', 0);
      });

    node.append('text')
      .attr('x', d => d.x0 < width / 2 ? d.x1 + 8 : d.x0 - 8)
      .attr('y', d => (d.y1 + d.y0) / 2)
      .attr('dy', '0.35em')
      .attr('text-anchor', d => d.x0 < width / 2 ? 'start' : 'end')
      .attr('fill', 'rgba(255,255,255,0.95)')
      .attr('font-size', 14)
      .style('text-shadow', '0 0 6px rgba(0,0,0,0.8)')
      .text(d => d.name);

    function buildData() {
      return {
        nodes: [
          { name: 'Source A' },
          { name: 'Source B' },
          { name: 'Process X' },
          { name: 'Process Y' },
          { name: 'Output 1' },
          { name: 'Output 2' }
        ],
        links: [
          { source: 0, target: 2, value: 5 },
          { source: 1, target: 2, value: 3 },
          { source: 0, target: 3, value: 2 },
          { source: 2, target: 4, value: 6 },
          { source: 3, target: 5, value: 3 }
        ]
      };
    }
  </script>
</body>
</html>