import{c as Mt,d as Lt,e as Xt,f as Et,a as G,t as Yt,r as lt,b as $t,g as Pt,j as pt}from"./index-CADqKax2.js";import{n as Gt,a as Rt,d as Ot,b as wt,c as _t,y as Ft,p as Nt,z as Qt}from"./zoom-BP8ZKEQd.js";import{u as Ut}from"./useResizeObserver-5kRlT9VM.js";/* empty css                      */function Kt(t){return typeof t=="string"?new Mt([document.querySelectorAll(t)],[document.documentElement]):new Mt([Xt(t)],Lt)}const xt=t=>()=>t;function bt(t,{sourceEvent:e,subject:n,target:l,identifier:a,active:o,x:u,y:i,dx:h,dy:s,dispatch:d}){Object.defineProperties(this,{type:{value:t,enumerable:!0,configurable:!0},sourceEvent:{value:e,enumerable:!0,configurable:!0},subject:{value:n,enumerable:!0,configurable:!0},target:{value:l,enumerable:!0,configurable:!0},identifier:{value:a,enumerable:!0,configurable:!0},active:{value:o,enumerable:!0,configurable:!0},x:{value:u,enumerable:!0,configurable:!0},y:{value:i,enumerable:!0,configurable:!0},dx:{value:h,enumerable:!0,configurable:!0},dy:{value:s,enumerable:!0,configurable:!0},_:{value:d}})}bt.prototype.on=function(){var t=this._.on.apply(this._,arguments);return t===this._?this:t};function Jt(t){return!t.ctrlKey&&!t.button}function Vt(){return this.parentNode}function qt(t,e){return e??{x:t.x,y:t.y}}function Ht(){return navigator.maxTouchPoints||"ontouchstart"in this}function Zt(){var t=Jt,e=Vt,n=qt,l=Ht,a={},o=Et("start","drag","end"),u=0,i,h,s,d,A=0;function y(r){r.on("mousedown.drag",p).filter(l).on("touchstart.drag",c).on("touchmove.drag",g,Gt).on("touchend.drag touchcancel.drag",v).style("touch-action","none").style("-webkit-tap-highlight-color","rgba(0,0,0,0)")}function p(r,x){if(!(d||!t.call(this,r,x))){var k=$(this,e.call(this,r,x),r,x,"mouse");k&&(G(r.view).on("mousemove.drag",w,Rt).on("mouseup.drag",f,Rt),Ot(r.view),wt(r),s=!1,i=r.clientX,h=r.clientY,k("start",r))}}function w(r){if(_t(r),!s){var x=r.clientX-i,k=r.clientY-h;s=x*x+k*k>A}a.mouse("drag",r)}function f(r){G(r.view).on("mousemove.drag mouseup.drag",null),Ft(r.view,s),_t(r),a.mouse("end",r)}function c(r,x){if(t.call(this,r,x)){var k=r.changedTouches,R=e.call(this,r,x),M=k.length,E,T;for(E=0;E<M;++E)(T=$(this,R,r,x,k[E].identifier,k[E]))&&(wt(r),T("start",r,k[E]))}}function g(r){var x=r.changedTouches,k=x.length,R,M;for(R=0;R<k;++R)(M=a[x[R].identifier])&&(_t(r),M("drag",r,x[R]))}function v(r){var x=r.changedTouches,k=x.length,R,M;for(d&&clearTimeout(d),d=setTimeout(function(){d=null},500),R=0;R<k;++R)(M=a[x[R].identifier])&&(wt(r),M("end",r,x[R]))}function $(r,x,k,R,M,E){var T=o.copy(),I=Nt(E||k,x),K,D,J;if((J=n.call(r,new bt("beforestart",{sourceEvent:k,target:y,identifier:M,active:u,x:I[0],y:I[1],dx:0,dy:0,dispatch:T}),R))!=null)return K=J.x-I[0]||0,D=J.y-I[1]||0,function V(H,ot,gt){var ut=I,ct;switch(H){case"start":a[M]=V,ct=u++;break;case"end":delete a[M],--u;case"drag":I=Nt(gt||ot,x),ct=u;break}T.call(H,r,new bt(H,{sourceEvent:ot,subject:J,target:y,identifier:M,active:ct,x:I[0]+K,y:I[1]+D,dx:I[0]-ut[0],dy:I[1]-ut[1],dispatch:T}),R)}}return y.filter=function(r){return arguments.length?(t=typeof r=="function"?r:xt(!!r),y):t},y.container=function(r){return arguments.length?(e=typeof r=="function"?r:xt(r),y):e},y.subject=function(r){return arguments.length?(n=typeof r=="function"?r:xt(r),y):n},y.touchable=function(r){return arguments.length?(l=typeof r=="function"?r:xt(!!r),y):l},y.on=function(){var r=o.on.apply(o,arguments);return r===o?y:r},y.clickDistance=function(r){return arguments.length?(A=(r=+r)*r,y):Math.sqrt(A)},y}function te(t,e){var n,l=1;t==null&&(t=0),e==null&&(e=0);function a(){var o,u=n.length,i,h=0,s=0;for(o=0;o<u;++o)i=n[o],h+=i.x,s+=i.y;for(h=(h/u-t)*l,s=(s/u-e)*l,o=0;o<u;++o)i=n[o],i.x-=h,i.y-=s}return a.initialize=function(o){n=o},a.x=function(o){return arguments.length?(t=+o,a):t},a.y=function(o){return arguments.length?(e=+o,a):e},a.strength=function(o){return arguments.length?(l=+o,a):l},a}function ee(t){const e=+this._x.call(null,t),n=+this._y.call(null,t);return jt(this.cover(e,n),e,n,t)}function jt(t,e,n,l){if(isNaN(e)||isNaN(n))return t;var a,o=t._root,u={data:l},i=t._x0,h=t._y0,s=t._x1,d=t._y1,A,y,p,w,f,c,g,v;if(!o)return t._root=u,t;for(;o.length;)if((f=e>=(A=(i+s)/2))?i=A:s=A,(c=n>=(y=(h+d)/2))?h=y:d=y,a=o,!(o=o[g=c<<1|f]))return a[g]=u,t;if(p=+t._x.call(null,o.data),w=+t._y.call(null,o.data),e===p&&n===w)return u.next=o,a?a[g]=u:t._root=u,t;do a=a?a[g]=new Array(4):t._root=new Array(4),(f=e>=(A=(i+s)/2))?i=A:s=A,(c=n>=(y=(h+d)/2))?h=y:d=y;while((g=c<<1|f)===(v=(w>=y)<<1|p>=A));return a[v]=o,a[g]=u,t}function ne(t){var e,n,l=t.length,a,o,u=new Array(l),i=new Array(l),h=1/0,s=1/0,d=-1/0,A=-1/0;for(n=0;n<l;++n)isNaN(a=+this._x.call(null,e=t[n]))||isNaN(o=+this._y.call(null,e))||(u[n]=a,i[n]=o,a<h&&(h=a),a>d&&(d=a),o<s&&(s=o),o>A&&(A=o));if(h>d||s>A)return this;for(this.cover(h,s).cover(d,A),n=0;n<l;++n)jt(this,u[n],i[n],t[n]);return this}function re(t,e){if(isNaN(t=+t)||isNaN(e=+e))return this;var n=this._x0,l=this._y0,a=this._x1,o=this._y1;if(isNaN(n))a=(n=Math.floor(t))+1,o=(l=Math.floor(e))+1;else{for(var u=a-n||1,i=this._root,h,s;n>t||t>=a||l>e||e>=o;)switch(s=(e<l)<<1|t<n,h=new Array(4),h[s]=i,i=h,u*=2,s){case 0:a=n+u,o=l+u;break;case 1:n=a-u,o=l+u;break;case 2:a=n+u,l=o-u;break;case 3:n=a-u,l=o-u;break}this._root&&this._root.length&&(this._root=i)}return this._x0=n,this._y0=l,this._x1=a,this._y1=o,this}function ie(){var t=[];return this.visit(function(e){if(!e.length)do t.push(e.data);while(e=e.next)}),t}function oe(t){return arguments.length?this.cover(+t[0][0],+t[0][1]).cover(+t[1][0],+t[1][1]):isNaN(this._x0)?void 0:[[this._x0,this._y0],[this._x1,this._y1]]}function O(t,e,n,l,a){this.node=t,this.x0=e,this.y0=n,this.x1=l,this.y1=a}function ae(t,e,n){var l,a=this._x0,o=this._y0,u,i,h,s,d=this._x1,A=this._y1,y=[],p=this._root,w,f;for(p&&y.push(new O(p,a,o,d,A)),n==null?n=1/0:(a=t-n,o=e-n,d=t+n,A=e+n,n*=n);w=y.pop();)if(!(!(p=w.node)||(u=w.x0)>d||(i=w.y0)>A||(h=w.x1)<a||(s=w.y1)<o))if(p.length){var c=(u+h)/2,g=(i+s)/2;y.push(new O(p[3],c,g,h,s),new O(p[2],u,g,c,s),new O(p[1],c,i,h,g),new O(p[0],u,i,c,g)),(f=(e>=g)<<1|t>=c)&&(w=y[y.length-1],y[y.length-1]=y[y.length-1-f],y[y.length-1-f]=w)}else{var v=t-+this._x.call(null,p.data),$=e-+this._y.call(null,p.data),r=v*v+$*$;if(r<n){var x=Math.sqrt(n=r);a=t-x,o=e-x,d=t+x,A=e+x,l=p.data}}return l}function se(t){if(isNaN(d=+this._x.call(null,t))||isNaN(A=+this._y.call(null,t)))return this;var e,n=this._root,l,a,o,u=this._x0,i=this._y0,h=this._x1,s=this._y1,d,A,y,p,w,f,c,g;if(!n)return this;if(n.length)for(;;){if((w=d>=(y=(u+h)/2))?u=y:h=y,(f=A>=(p=(i+s)/2))?i=p:s=p,e=n,!(n=n[c=f<<1|w]))return this;if(!n.length)break;(e[c+1&3]||e[c+2&3]||e[c+3&3])&&(l=e,g=c)}for(;n.data!==t;)if(a=n,!(n=n.next))return this;return(o=n.next)&&delete n.next,a?(o?a.next=o:delete a.next,this):e?(o?e[c]=o:delete e[c],(n=e[0]||e[1]||e[2]||e[3])&&n===(e[3]||e[2]||e[1]||e[0])&&!n.length&&(l?l[g]=n:this._root=n),this):(this._root=o,this)}function le(t){for(var e=0,n=t.length;e<n;++e)this.remove(t[e]);return this}function ce(){return this._root}function ue(){var t=0;return this.visit(function(e){if(!e.length)do++t;while(e=e.next)}),t}function fe(t){var e=[],n,l=this._root,a,o,u,i,h;for(l&&e.push(new O(l,this._x0,this._y0,this._x1,this._y1));n=e.pop();)if(!t(l=n.node,o=n.x0,u=n.y0,i=n.x1,h=n.y1)&&l.length){var s=(o+i)/2,d=(u+h)/2;(a=l[3])&&e.push(new O(a,s,d,i,h)),(a=l[2])&&e.push(new O(a,o,d,s,h)),(a=l[1])&&e.push(new O(a,s,u,i,d)),(a=l[0])&&e.push(new O(a,o,u,s,d))}return this}function he(t){var e=[],n=[],l;for(this._root&&e.push(new O(this._root,this._x0,this._y0,this._x1,this._y1));l=e.pop();){var a=l.node;if(a.length){var o,u=l.x0,i=l.y0,h=l.x1,s=l.y1,d=(u+h)/2,A=(i+s)/2;(o=a[0])&&e.push(new O(o,u,i,d,A)),(o=a[1])&&e.push(new O(o,d,i,h,A)),(o=a[2])&&e.push(new O(o,u,A,d,s)),(o=a[3])&&e.push(new O(o,d,A,h,s))}n.push(l)}for(;l=n.pop();)t(l.node,l.x0,l.y0,l.x1,l.y1);return this}function pe(t){return t[0]}function ge(t){return arguments.length?(this._x=t,this):this._x}function de(t){return t[1]}function ye(t){return arguments.length?(this._y=t,this):this._y}function kt(t,e,n){var l=new At(e??pe,n??de,NaN,NaN,NaN,NaN);return t==null?l:l.addAll(t)}function At(t,e,n,l,a,o){this._x=t,this._y=e,this._x0=n,this._y0=l,this._x1=a,this._y1=o,this._root=void 0}function St(t){for(var e={data:t.data},n=e;t=t.next;)n=n.next={data:t.data};return e}var Q=kt.prototype=At.prototype;Q.copy=function(){var t=new At(this._x,this._y,this._x0,this._y0,this._x1,this._y1),e=this._root,n,l;if(!e)return t;if(!e.length)return t._root=St(e),t;for(n=[{source:e,target:t._root=new Array(4)}];e=n.pop();)for(var a=0;a<4;++a)(l=e.source[a])&&(l.length?n.push({source:l,target:e.target[a]=new Array(4)}):e.target[a]=St(l));return t};Q.add=ee;Q.addAll=ne;Q.cover=re;Q.data=ie;Q.extent=oe;Q.find=ae;Q.remove=se;Q.removeAll=le;Q.root=ce;Q.size=ue;Q.visit=fe;Q.visitAfter=he;Q.x=ge;Q.y=ye;function F(t){return function(){return t}}function it(t){return(t()-.5)*1e-6}function ve(t){return t.x+t.vx}function xe(t){return t.y+t.vy}function me(t){var e,n,l,a=1,o=1;typeof t!="function"&&(t=F(t==null?1:+t));function u(){for(var s,d=e.length,A,y,p,w,f,c,g=0;g<o;++g)for(A=kt(e,ve,xe).visitAfter(i),s=0;s<d;++s)y=e[s],f=n[y.index],c=f*f,p=y.x+y.vx,w=y.y+y.vy,A.visit(v);function v($,r,x,k,R){var M=$.data,E=$.r,T=f+E;if(M){if(M.index>y.index){var I=p-M.x-M.vx,K=w-M.y-M.vy,D=I*I+K*K;D<T*T&&(I===0&&(I=it(l),D+=I*I),K===0&&(K=it(l),D+=K*K),D=(T-(D=Math.sqrt(D)))/D*a,y.vx+=(I*=D)*(T=(E*=E)/(c+E)),y.vy+=(K*=D)*T,M.vx-=I*(T=1-T),M.vy-=K*T)}return}return r>p+T||k<p-T||x>w+T||R<w-T}}function i(s){if(s.data)return s.r=n[s.data.index];for(var d=s.r=0;d<4;++d)s[d]&&s[d].r>s.r&&(s.r=s[d].r)}function h(){if(e){var s,d=e.length,A;for(n=new Array(d),s=0;s<d;++s)A=e[s],n[A.index]=+t(A,s,e)}}return u.initialize=function(s,d){e=s,l=d,h()},u.iterations=function(s){return arguments.length?(o=+s,u):o},u.strength=function(s){return arguments.length?(a=+s,u):a},u.radius=function(s){return arguments.length?(t=typeof s=="function"?s:F(+s),h(),u):t},u}function we(t){return t.index}function zt(t,e){var n=t.get(e);if(!n)throw new Error("node not found: "+e);return n}function _e(t){var e=we,n=A,l,a=F(30),o,u,i,h,s,d=1;t==null&&(t=[]);function A(c){return 1/Math.min(i[c.source.index],i[c.target.index])}function y(c){for(var g=0,v=t.length;g<d;++g)for(var $=0,r,x,k,R,M,E,T;$<v;++$)r=t[$],x=r.source,k=r.target,R=k.x+k.vx-x.x-x.vx||it(s),M=k.y+k.vy-x.y-x.vy||it(s),E=Math.sqrt(R*R+M*M),E=(E-o[$])/E*c*l[$],R*=E,M*=E,k.vx-=R*(T=h[$]),k.vy-=M*T,x.vx+=R*(T=1-T),x.vy+=M*T}function p(){if(u){var c,g=u.length,v=t.length,$=new Map(u.map((x,k)=>[e(x,k,u),x])),r;for(c=0,i=new Array(g);c<v;++c)r=t[c],r.index=c,typeof r.source!="object"&&(r.source=zt($,r.source)),typeof r.target!="object"&&(r.target=zt($,r.target)),i[r.source.index]=(i[r.source.index]||0)+1,i[r.target.index]=(i[r.target.index]||0)+1;for(c=0,h=new Array(v);c<v;++c)r=t[c],h[c]=i[r.source.index]/(i[r.source.index]+i[r.target.index]);l=new Array(v),w(),o=new Array(v),f()}}function w(){if(u)for(var c=0,g=t.length;c<g;++c)l[c]=+n(t[c],c,t)}function f(){if(u)for(var c=0,g=t.length;c<g;++c)o[c]=+a(t[c],c,t)}return y.initialize=function(c,g){u=c,s=g,p()},y.links=function(c){return arguments.length?(t=c,p(),y):t},y.id=function(c){return arguments.length?(e=c,y):e},y.iterations=function(c){return arguments.length?(d=+c,y):d},y.strength=function(c){return arguments.length?(n=typeof c=="function"?c:F(+c),w(),y):n},y.distance=function(c){return arguments.length?(a=typeof c=="function"?c:F(+c),f(),y):a},y}const be=1664525,ke=1013904223,Tt=4294967296;function Ae(){let t=1;return()=>(t=(be*t+ke)%Tt)/Tt}function Me(t){return t.x}function $e(t){return t.y}var Re=10,Ne=Math.PI*(3-Math.sqrt(5));function Se(t){var e,n=1,l=.001,a=1-Math.pow(l,1/300),o=0,u=.6,i=new Map,h=Yt(A),s=Et("tick","end"),d=Ae();t==null&&(t=[]);function A(){y(),s.call("tick",e),n<l&&(h.stop(),s.call("end",e))}function y(f){var c,g=t.length,v;f===void 0&&(f=1);for(var $=0;$<f;++$)for(n+=(o-n)*a,i.forEach(function(r){r(n)}),c=0;c<g;++c)v=t[c],v.fx==null?v.x+=v.vx*=u:(v.x=v.fx,v.vx=0),v.fy==null?v.y+=v.vy*=u:(v.y=v.fy,v.vy=0);return e}function p(){for(var f=0,c=t.length,g;f<c;++f){if(g=t[f],g.index=f,g.fx!=null&&(g.x=g.fx),g.fy!=null&&(g.y=g.fy),isNaN(g.x)||isNaN(g.y)){var v=Re*Math.sqrt(.5+f),$=f*Ne;g.x=v*Math.cos($),g.y=v*Math.sin($)}(isNaN(g.vx)||isNaN(g.vy))&&(g.vx=g.vy=0)}}function w(f){return f.initialize&&f.initialize(t,d),f}return p(),e={tick:y,restart:function(){return h.restart(A),e},stop:function(){return h.stop(),e},nodes:function(f){return arguments.length?(t=f,p(),i.forEach(w),e):t},alpha:function(f){return arguments.length?(n=+f,e):n},alphaMin:function(f){return arguments.length?(l=+f,e):l},alphaDecay:function(f){return arguments.length?(a=+f,e):+a},alphaTarget:function(f){return arguments.length?(o=+f,e):o},velocityDecay:function(f){return arguments.length?(u=1-f,e):1-u},randomSource:function(f){return arguments.length?(d=f,i.forEach(w),e):d},force:function(f,c){return arguments.length>1?(c==null?i.delete(f):i.set(f,w(c)),e):i.get(f)},find:function(f,c,g){var v=0,$=t.length,r,x,k,R,M;for(g==null?g=1/0:g*=g,v=0;v<$;++v)R=t[v],r=f-R.x,x=c-R.y,k=r*r+x*x,k<g&&(M=R,g=k);return M},on:function(f,c){return arguments.length>1?(s.on(f,c),e):s.on(f)}}}function ze(){var t,e,n,l,a=F(-30),o,u=1,i=1/0,h=.81;function s(p){var w,f=t.length,c=kt(t,Me,$e).visitAfter(A);for(l=p,w=0;w<f;++w)e=t[w],c.visit(y)}function d(){if(t){var p,w=t.length,f;for(o=new Array(w),p=0;p<w;++p)f=t[p],o[f.index]=+a(f,p,t)}}function A(p){var w=0,f,c,g=0,v,$,r;if(p.length){for(v=$=r=0;r<4;++r)(f=p[r])&&(c=Math.abs(f.value))&&(w+=f.value,g+=c,v+=c*f.x,$+=c*f.y);p.x=v/g,p.y=$/g}else{f=p,f.x=f.data.x,f.y=f.data.y;do w+=o[f.data.index];while(f=f.next)}p.value=w}function y(p,w,f,c){if(!p.value)return!0;var g=p.x-e.x,v=p.y-e.y,$=c-w,r=g*g+v*v;if($*$/h<r)return r<i&&(g===0&&(g=it(n),r+=g*g),v===0&&(v=it(n),r+=v*v),r<u&&(r=Math.sqrt(u*r)),e.vx+=g*p.value*l/r,e.vy+=v*p.value*l/r),!0;if(p.length||r>=i)return;(p.data!==e||p.next)&&(g===0&&(g=it(n),r+=g*g),v===0&&(v=it(n),r+=v*v),r<u&&(r=Math.sqrt(u*r)));do p.data!==e&&($=o[p.data.index]*l/r,e.vx+=g*$,e.vy+=v*$);while(p=p.next)}return s.initialize=function(p,w){t=p,n=w,d()},s.strength=function(p){return arguments.length?(a=typeof p=="function"?p:F(+p),d(),s):a},s.distanceMin=function(p){return arguments.length?(u=p*p,s):Math.sqrt(u)},s.distanceMax=function(p){return arguments.length?(i=p*p,s):Math.sqrt(i)},s.theta=function(p){return arguments.length?(h=p*p,s):Math.sqrt(h)},s}function Te(t){var e=F(.1),n,l,a;typeof t!="function"&&(t=F(t==null?0:+t));function o(i){for(var h=0,s=n.length,d;h<s;++h)d=n[h],d.vx+=(a[h]-d.x)*l[h]*i}function u(){if(n){var i,h=n.length;for(l=new Array(h),a=new Array(h),i=0;i<h;++i)l[i]=isNaN(a[i]=+t(n[i],i,n))?0:+e(n[i],i,n)}}return o.initialize=function(i){n=i,u()},o.strength=function(i){return arguments.length?(e=typeof i=="function"?i:F(+i),u(),o):e},o.x=function(i){return arguments.length?(t=typeof i=="function"?i:F(+i),u(),o):t},o}function Ee(t){var e=F(.1),n,l,a;typeof t!="function"&&(t=F(t==null?0:+t));function o(i){for(var h=0,s=n.length,d;h<s;++h)d=n[h],d.vy+=(a[h]-d.y)*l[h]*i}function u(){if(n){var i,h=n.length;for(l=new Array(h),a=new Array(h),i=0;i<h;++i)l[i]=isNaN(a[i]=+t(n[i],i,n))?0:+e(n[i],i,n)}}return o.initialize=function(i){n=i,u()},o.strength=function(i){return arguments.length?(e=typeof i=="function"?i:F(+i),u(),o):e},o.y=function(i){return arguments.length?(t=typeof i=="function"?i:F(+i),u(),o):t},o}const je={baseColor:"#A4B6C1",baseWidth:20,baseOpacity:.6,overlayWidth:12,overlayOpacity:.5,colors:{partOf:"#244855",contains:"#E64833",default:"#90AEAD"}},Be={linkDistance:(t,e)=>t==="hub"||e==="hub"?255:t==="pillar"&&e==="sub"?173:210,chargeStrength:-520,collisionStrength:1,collisionIterations:3,centerStrength:{x:.1,y:.1}},Ce={keys:["who","what","when","where","why","which","how"],questionMap:{who:"Who is involved?",what:"What is it?",when:"When does it occur?",where:"Where does it happen?",why:"Why does it matter?",which:"Which options are available?",how:"How does it work?"},distance:30,radius:16,glowRadius:20,fontSize:9,strokeWidth:2},Ie={scaleExtent:[.1,4],initialScale:.85,initialTranslate:{x:.1,y:.08},transitionDuration:750};function mt(t,e){return e?{...t,...e}:t}function Ye({data:t,nodeGroupConfigs:e,linkStyleConfig:n,forceConfig:l,satelliteConfig:a,zoomConfig:o,minWidth:u=860,minHeight:i=400,enableDrag:h=!0,enableZoom:s=!0,enableSatellites:d=!0,popoverClassName:A,tooltipClassName:y,onNodeClick:p,onNodeHover:w}){const{ref:f,rect:c}=Ut(),g=lt.useRef(null),v=lt.useRef(null),$=lt.useRef(null),r=lt.useRef(null),x=lt.useRef(null),k=mt(je,n),R=mt(Be,l),M=mt(Ce,a),E=mt(Ie,o),T=lt.useMemo(()=>{const D=t.nodes.map(V=>({...V})),J=t.links.map(V=>({...V}));return{nodes:D,links:J}},[t]);lt.useEffect(()=>{const D=g.current;if(!D)return;const J=Math.max(u,c.width),V=Math.max(i,c.height);D.setAttribute("viewBox",`0 0 ${J} ${V}`);const H=G(D);H.selectAll("*").remove();const ot=H.append("g").attr("class","zoom-container"),gt=H.append("defs");Object.entries(e).forEach(([m,b])=>{const _=gt.append("linearGradient").attr("id",`${m}Gradient`).attr("x1","0%").attr("y1","0%").attr("x2","100%").attr("y2","100%");b.gradient.forEach((j,z)=>{_.append("stop").attr("offset",`${z/(b.gradient.length-1)*100}%`).attr("stop-color",j)});const N=gt.append("linearGradient").attr("id",`${m}SatelliteGradient`).attr("x1","0%").attr("y1","0%").attr("x2","100%").attr("y2","100%");b.satelliteGradient.forEach((j,z)=>{N.append("stop").attr("offset",`${z/(b.satelliteGradient.length-1)*100}%`).attr("stop-color",j)})});const ut=T.nodes.map(m=>({...m})),ct=T.links.map(m=>({...m})),dt=Se(ut).force("link",_e(ct).id(m=>m.id).distance(m=>{const b=m.source,_=m.target;return R.linkDistance(b.group,_.group)})).force("charge",ze().strength(R.chargeStrength)).force("collide",me().radius(m=>{const _=e[m.group];return _?_.collisionRadius:50}).strength(R.collisionStrength).iterations(R.collisionIterations)).force("center",te(J/2,V/2)).force("x",Te(J/2).strength(R.centerStrength.x)).force("y",Ee(V/2).strength(R.centerStrength.y)).alphaDecay(.02).velocityDecay(.4);if(s){const m=Qt().scaleExtent(E.scaleExtent).on("zoom",_=>{ot.attr("transform",_.transform)});H.call(m);const b=$t.translate(J*E.initialTranslate.x,V*E.initialTranslate.y).scale(E.initialScale);H.call(m.transform,b),H.on("dblclick.zoom",()=>{H.transition().duration(E.transitionDuration).call(m.transform,b)})}const Bt=ot.append("g").attr("class","links"),Ct=ot.append("g").attr("class","nodes"),et=ot.append("g").attr("class","satellites"),ft=Bt.selectAll("g.link").data(ct).join("g").attr("class","link");ft.append("path").attr("class","link-base").attr("fill","none").attr("stroke",k.baseColor).attr("stroke-width",k.baseWidth).attr("opacity",k.baseOpacity).attr("stroke-linecap","round"),ft.append("path").attr("class","link-overlay").attr("fill","none").attr("stroke",m=>k.colors[m.type||"default"]||k.colors.default).attr("stroke-width",k.overlayWidth).attr("opacity",k.overlayOpacity).attr("stroke-linecap","round"),ft.append("path").attr("class","link-hover-target").attr("fill","none").attr("stroke","transparent").attr("stroke-width",20).style("cursor","pointer"),ft.on("mouseenter",function(m,b){const _=r.current,N=f.current;if(!_||!N)return;const j=$.current;j&&(j.style.display="none");const z=b.source,B=b.target,W=b.relationship||b.type||"connects to",C=b.description||`${z.label} ${W.toLowerCase()} ${B.label}`;_.innerHTML=`
          <div class="force-directed-graph__link-popover-header">
            <span class="force-directed-graph__link-popover-source">${z.label}</span>
            <span class="force-directed-graph__link-popover-arrow">â†’</span>
            <span class="force-directed-graph__link-popover-target">${B.label}</span>
          </div>
          <div class="force-directed-graph__link-popover-relationship">${W}</div>
          <div class="force-directed-graph__link-popover-description">${C}</div>
        `,_.style.display="block";const L=N.getBoundingClientRect(),P=_.getBoundingClientRect(),S=15,X=10;let U=m.pageX-L.left+S,Z=m.pageY-L.top+S;U+P.width>L.width-X&&(U=m.pageX-L.left-P.width-S),Z+P.height>L.height-X&&(Z=m.pageY-L.top-P.height-S),U<X&&(U=X),Z<X&&(Z=X),_.style.left=U+"px",_.style.top=Z+"px",G(this).select(".link-overlay").transition().duration(200).attr("stroke-width",k.overlayWidth*2).attr("opacity",1),G(this).select(".link-base").transition().duration(200).attr("stroke-width",k.baseWidth*1.5)}).on("mousemove",function(m){const b=r.current,_=f.current;if(!b||!_)return;const N=_.getBoundingClientRect(),j=b.getBoundingClientRect(),z=15,B=10;let W=m.pageX-N.left+z,C=m.pageY-N.top+z;W+j.width>N.width-B&&(W=m.pageX-N.left-j.width-z),C+j.height>N.height-B&&(C=m.pageY-N.top-j.height-z),W<B&&(W=B),C<B&&(C=B),b.style.left=W+"px",b.style.top=C+"px"}).on("mouseleave",function(){const m=r.current;m&&(m.style.display="none"),G(this).select(".link-overlay").transition().duration(200).attr("stroke-width",k.overlayWidth).attr("opacity",k.overlayOpacity),G(this).select(".link-base").transition().duration(200).attr("stroke-width",k.baseWidth)});function It(m){if(!d)return;x.current&&(clearTimeout(x.current),x.current=null),et.selectAll("*").remove();const b=v.current;b&&(b.style.display="none");const _=M.keys.filter(S=>m[S]&&String(m[S]).trim().length>0);if(_.length===0)return;const N=e[m.group];if(!N)return;const j=N.glowRadius+M.distance,z=Math.PI*2/_.length,B=m.x||J/2,W=m.y||V/2,C=_.map((S,X)=>({key:S,label:S,text:String(m[S]||""),x:B+j*Math.cos(X*z-Math.PI/2),y:W+j*Math.sin(X*z-Math.PI/2)})),L=`${m.group}SatelliteGradient`;et.selectAll("line.satellite-connector").data(C).join("line").attr("class","satellite-connector").attr("x1",B).attr("y1",W).attr("x2",S=>S.x).attr("y2",S=>S.y).attr("stroke",`url(#${L})`).attr("stroke-width",M.strokeWidth).attr("opacity",.4).attr("stroke-dasharray","4,4");const P=et.selectAll("g.satellite").data(C).join("g").attr("class","satellite").attr("transform",S=>`translate(${S.x},${S.y})`).style("cursor","pointer");P.append("circle").attr("r",M.glowRadius).attr("fill",`url(#${L})`).attr("opacity",.25),P.append("circle").attr("r",M.radius).attr("fill",`url(#${L})`).attr("opacity",.85).attr("stroke",N.stroke).attr("stroke-width",M.strokeWidth).style("filter","drop-shadow(0px 4px 8px rgba(36, 72, 85, 0.3))"),P.append("text").attr("text-anchor","middle").attr("dy",4).attr("font-size",M.fontSize).attr("font-weight",700).attr("font-family",'Inter, -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif').attr("fill","#ffffff").style("pointer-events","none").style("text-shadow","0px 1px 3px rgba(0,0,0,0.5)").style("letter-spacing","0.3px").text(S=>S.label.charAt(0).toUpperCase()+S.label.slice(1).toLowerCase()),P.on("mouseenter",(S,X)=>{x.current&&(clearTimeout(x.current),x.current=null);const U=v.current,Z=f.current;if(!U||!Z)return;const vt=M.questionMap[X.key]||X.key;U.innerHTML=`
          <div class="force-directed-graph__tooltip-question">${vt}</div>
          <div class="force-directed-graph__tooltip-answer">${X.text}</div>
        `,U.style.display="block";const nt=Z.getBoundingClientRect(),q=U.getBoundingClientRect(),at=15,tt=10;let Y=S.pageX-nt.left+at,rt=S.pageY-nt.top+at;Y+q.width>nt.width-tt&&(Y=S.pageX-nt.left-q.width-at),rt+q.height>nt.height-tt&&(rt=S.pageY-nt.top-q.height-at),Y<tt&&(Y=tt),rt<tt&&(rt=tt),U.style.left=Y+"px",U.style.top=rt+"px",G(S.currentTarget).select("circle:nth-child(2)").transition().duration(200).attr("r",M.radius+2)}),P.on("mouseleave",()=>{const S=v.current;S&&(S.style.display="none"),Kt(".satellite circle:nth-child(2)").transition().duration(200).attr("r",M.radius)}),et.on("mouseenter",()=>{x.current&&(clearTimeout(x.current),x.current=null)}),et.on("mouseleave",()=>{x.current=window.setTimeout(()=>{et.selectAll("*").remove();const S=v.current;S&&(S.style.display="none")},100)})}const Dt=Zt().on("start",function(m,b){m.active||dt.alphaTarget(.3).restart(),b.fx=b.x,b.fy=b.y,G(this).style("cursor","grabbing"),et.selectAll("*").remove();const _=v.current;_&&(_.style.display="none");const N=$.current;N&&(N.style.display="none")}).on("drag",function(m,b){b.fx=m.x,b.fy=m.y}).on("end",function(m,b){m.active||dt.alphaTarget(0),G(this).style("cursor","grab")}),yt=Ct.selectAll("g").data(ut).join("g").attr("class","node").style("cursor",h?"grab":"pointer");h&&yt.call(Dt),yt.on("mouseenter",function(m,b){var j;x.current&&(clearTimeout(x.current),x.current=null),G(this).selectAll("circle").transition().duration(200).attr("r",function(){return parseFloat(G(this).attr("r"))*1.15});const _=b;It(_),w&&w(_);const N=$.current;if(N&&_.detail){N.innerHTML=`
            <div class="force-directed-graph__popover-title">${_.label}</div>
            <div class="force-directed-graph__popover-content">${_.detail}</div>
          `,N.style.display="block";const z=g.current,B=f.current;if(z&&B&&_.x!==void 0&&_.y!==void 0){const W=z.getBoundingClientRect(),C=B.getBoundingClientRect(),L=((j=z.getAttribute("viewBox"))==null?void 0:j.split(" ").map(Number))||[0,0,J,V],P=W.width/L[2],S=W.height/L[3],X=s?Pt(z):$t,U=X.applyX(_.x),Z=X.applyY(_.y),vt=W.left-C.left+U*P,nt=W.top-C.top+Z*S,q=N.getBoundingClientRect(),at=e[_.group],tt=at?at.radius*P*X.k:32,Y=15,rt=10;let st=vt+tt+rt,ht=nt-q.height/2;st+q.width>C.width-Y&&(st=vt-tt-q.width-rt),st<Y&&(st=Y),st+q.width>C.width-Y&&(st=Math.max(Y,C.width-q.width-Y)),ht<Y&&(ht=Y),ht+q.height>C.height-Y&&(ht=Math.max(Y,C.height-q.height-Y)),N.style.left=st+"px",N.style.top=ht+"px"}}}).on("mouseleave",function(m,b){const N=e[b.group];N&&(G(this).select("circle.glow").transition().duration(200).attr("r",N.glowRadius),G(this).select("circle:not(.glow)").transition().duration(200).attr("r",N.radius));const j=$.current;j&&(j.style.display="none"),w&&w(null),x.current=window.setTimeout(()=>{et.selectAll("*").remove();const z=v.current;z&&(z.style.display="none")},100)}).on("click",(m,b)=>{p&&p(b)}),yt.each(function(m){const b=m,_=e[b.group];if(!_)return;const N=G(this);N.append("circle").attr("class","glow").attr("r",_.glowRadius).attr("fill",`url(#${b.group}Gradient)`).attr("opacity",.25),N.append("circle").attr("r",_.radius).attr("fill",`url(#${b.group}Gradient)`).attr("opacity",.85).attr("stroke",_.stroke).attr("stroke-width",3).style("filter","drop-shadow(0px 6px 12px rgba(36, 72, 85, 0.4))");const j=b.label.split(" "),z=[];let B="";j.forEach(C=>{const L=B?`${B} ${C}`:C;L.length<=_.maxChars?B=L:(B&&z.push(B),B=C)}),B&&z.push(B);const W=N.append("text").attr("x",0).attr("y",0).attr("text-anchor","middle").attr("font-size",_.fontSize).attr("font-weight",800).attr("font-family",'Inter, -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif').attr("fill","white").style("pointer-events","none").style("text-shadow","0px 2px 6px rgba(0,0,0,0.5)").style("letter-spacing","0.3px");z.forEach((C,L)=>{const P=(L-(z.length-1)/2)*_.fontSize*1.4;W.append("tspan").text(C).attr("x",0).attr("y",P)})});function Wt(m){const b=m.source,_=m.target,N=_.x-b.x,j=_.y-b.y,z=Math.sqrt(N*N+j*j)*1.1;return`M${b.x},${b.y} A${z},${z} 0 0,1 ${_.x},${_.y}`}return dt.on("tick",()=>{ft.selectAll("path").attr("d",Wt),yt.attr("transform",m=>`translate(${m.x}, ${m.y})`)}),()=>{dt.stop()}},[T,e,k,R,M,E,c.width,c.height,u,i,h,s,d,p,w]);const I=A?`force-directed-graph__popover ${A}`:"force-directed-graph__popover",K=y?`force-directed-graph__tooltip ${y}`:"force-directed-graph__tooltip";return pt.jsxs("div",{ref:f,className:"force-directed-graph",children:[pt.jsx("svg",{ref:g,width:"100%",height:"100%",className:"force-directed-graph__svg"}),pt.jsx("div",{ref:$,className:I}),pt.jsx("div",{ref:r,className:"force-directed-graph__link-popover"}),pt.jsx("div",{ref:v,className:K})]})}export{Ye as F};
