import{r as H,a as E,j as C}from"./index-DisIoiRj.js";import{z as ot}from"./zoom-CqcNJepO.js";import{u as st}from"./useResizeObserver-IvLdvs2c.js";function ct(t){var e=0,n=t.children,i=n&&n.length;if(!i)e=1;else for(;--i>=0;)e+=n[i].value;t.value=e}function lt(){return this.eachAfter(ct)}function ht(t,e){let n=-1;for(const i of this)t.call(e,i,++n,this);return this}function ut(t,e){for(var n=this,i=[n],s,o,h=-1;n=i.pop();)if(t.call(e,n,++h,this),s=n.children)for(o=s.length-1;o>=0;--o)i.push(s[o]);return this}function dt(t,e){for(var n=this,i=[n],s=[],o,h,g,$=-1;n=i.pop();)if(s.push(n),o=n.children)for(h=0,g=o.length;h<g;++h)i.push(o[h]);for(;n=s.pop();)t.call(e,n,++$,this);return this}function ft(t,e){let n=-1;for(const i of this)if(t.call(e,i,++n,this))return i}function pt(t){return this.eachAfter(function(e){for(var n=+t(e.data)||0,i=e.children,s=i&&i.length;--s>=0;)n+=i[s].value;e.value=n})}function xt(t){return this.eachBefore(function(e){e.children&&e.children.sort(t)})}function yt(t){for(var e=this,n=gt(e,t),i=[e];e!==n;)e=e.parent,i.push(e);for(var s=i.length;t!==n;)i.splice(s,0,t),t=t.parent;return i}function gt(t,e){if(t===e)return t;var n=t.ancestors(),i=e.ancestors(),s=null;for(t=n.pop(),e=i.pop();t===e;)s=t,t=n.pop(),e=i.pop();return s}function mt(){for(var t=this,e=[t];t=t.parent;)e.push(t);return e}function _t(){return Array.from(this)}function kt(){var t=[];return this.eachBefore(function(e){e.children||t.push(e)}),t}function bt(){var t=this,e=[];return t.each(function(n){n!==t&&e.push({source:n.parent,target:n})}),e}function*wt(){var t=this,e,n=[t],i,s,o;do for(e=n.reverse(),n=[];t=e.pop();)if(yield t,i=t.children)for(s=0,o=i.length;s<o;++s)n.push(i[s]);while(n.length)}function X(t,e){t instanceof Map?(t=[void 0,t],e===void 0&&(e=$t)):e===void 0&&(e=At);for(var n=new D(t),i,s=[n],o,h,g,$;i=s.pop();)if((h=e(i.data))&&($=(h=Array.from(h)).length))for(i.children=h,g=$-1;g>=0;--g)s.push(o=h[g]=new D(h[g])),o.parent=i,o.depth=i.depth+1;return n.eachBefore(Et)}function zt(){return X(this).eachBefore(vt)}function At(t){return t.children}function $t(t){return Array.isArray(t)?t[1]:null}function vt(t){t.data.value!==void 0&&(t.value=t.data.value),t.data=t.data.data}function Et(t){var e=0;do t.height=e;while((t=t.parent)&&t.height<++e)}function D(t){this.data=t,this.depth=this.height=0,this.parent=null}D.prototype=X.prototype={constructor:D,count:lt,each:ht,eachAfter:dt,eachBefore:ut,find:ft,sum:pt,sort:xt,path:yt,ancestors:mt,descendants:_t,leaves:kt,links:bt,copy:zt,[Symbol.iterator]:wt};function Bt(t,e){return t.parent===e.parent?1:2}function P(t){var e=t.children;return e?e[0]:t.t}function V(t){var e=t.children;return e?e[e.length-1]:t.t}function St(t,e,n){var i=n/(e.i-t.i);e.c-=i,e.s+=n,t.c+=i,e.z+=n,e.m+=n}function Ct(t){for(var e=0,n=0,i=t.children,s=i.length,o;--s>=0;)o=i[s],o.z+=e,o.m+=e,e+=o.s+(n+=o.c)}function Rt(t,e,n){return t.a.parent===e.parent?t.a:n}function W(t,e){this._=t,this.parent=null,this.children=null,this.A=null,this.a=this,this.z=0,this.m=0,this.c=0,this.s=0,this.t=null,this.i=e}W.prototype=Object.create(D.prototype);function jt(t){for(var e=new W(t,0),n,i=[e],s,o,h,g;n=i.pop();)if(o=n._.children)for(n.children=new Array(g=o.length),h=g-1;h>=0;--h)i.push(s=n.children[h]=new W(o[h],h)),s.parent=n;return(e.parent=new W(null,0)).children=[e],e}function Dt(){var t=Bt,e=1,n=1,i=null;function s(r){var x=jt(r);if(x.eachAfter(o),x.parent.m=-x.z,x.eachBefore(h),i)r.eachBefore($);else{var p=r,l=r,d=r;r.eachBefore(function(y){y.x<p.x&&(p=y),y.x>l.x&&(l=y),y.depth>d.depth&&(d=y)});var f=p===l?1:t(p,l)/2,b=f-p.x,v=e/(l.x+f+b),w=n/(d.depth||1);r.eachBefore(function(y){y.x=(y.x+b)*v,y.y=y.depth*w})}return r}function o(r){var x=r.children,p=r.parent.children,l=r.i?p[r.i-1]:null;if(x){Ct(r);var d=(x[0].z+x[x.length-1].z)/2;l?(r.z=l.z+t(r._,l._),r.m=r.z-d):r.z=d}else l&&(r.z=l.z+t(r._,l._));r.parent.A=g(r,l,r.parent.A||p[0])}function h(r){r._.x=r.z+r.parent.m,r.m+=r.parent.m}function g(r,x,p){if(x){for(var l=r,d=r,f=x,b=l.parent.children[0],v=l.m,w=d.m,y=f.m,N=b.m,z;f=V(f),l=P(l),f&&l;)b=P(b),d=V(d),d.a=r,z=f.z+y-l.z-v+t(f._,l._),z>0&&(St(Rt(f,r,p),r,z),v+=z,w+=z),y+=f.m,v+=l.m,N+=b.m,w+=d.m;f&&!V(d)&&(d.t=f,d.m+=y-w),l&&!P(b)&&(b.t=l,b.m+=v-N,p=r)}return p}function $(r){r.x*=e,r.y=r.depth*n}return s.separation=function(r){return arguments.length?(t=r,s):t},s.size=function(r){return arguments.length?(i=!1,e=+r[0],n=+r[1],s):i?null:[e,n]},s.nodeSize=function(r){return arguments.length?(i=!0,e=+r[0],n=+r[1],s):i?[e,n]:null},s}const Nt={root:"#244855",both:"#874F41",restricted:"#E64833",public:"#90AEAD",category:"#90AEAD"};function Tt({data:t,width:e,height:n,availabilityColors:i,className:s=""}){const o={...Nt,...i},h=H.useRef(null),{ref:g,rect:$}=st(),[r,x]=H.useState({visible:!1,content:null,x:0,y:0}),p=e||Math.max(800,$.width-40),l=n||Math.max(600,$.height-40);return H.useEffect(()=>{if(!h.current||!t||p<=0||l<=0)return;const d=p<768,f=p>=768&&p<1024,b=d?160:f?200:250,v=d?140:f?160:180,w=d?8:f?10:12,y=d?12:f?13:14,N=d?14:f?15:16,z=E(h.current);z.selectAll("*").remove();const F=z.attr("width",p).attr("height",l).attr("viewBox",`0 0 ${p} ${l}`).attr("preserveAspectRatio","xMidYMid meet").append("g").attr("transform",`translate(${p/2}, 80)`),Z=ot().scaleExtent([.5,2]).on("zoom",u=>{F.attr("transform",u.transform),x({visible:!1,content:null,x:0,y:0})});z.call(Z);const B=X(t);B.x0=0,B.y0=0,B.children&&B.children.forEach(u=>{u.children&&(u._children=u.children,u.children=null)});const tt=Dt().nodeSize([b,v]);function q(u){const J=tt(B),T=J.descendants(),et=J.links();T.forEach(a=>a.y=a.depth*v);const O=F.selectAll(".link").data(et,a=>a.target.data.title),Y=O.enter().insert("g","g").attr("class","link"),nt=d?16:f?20:24,rt=d?10:f?12:16;Y.append("path").attr("class","link-base").attr("fill","none").attr("stroke",a=>{const c=a.target.data.availability;return c==="both"?o.both:c==="restricted"?o.restricted:o.public}).attr("stroke-width",nt).attr("opacity",.3).attr("stroke-linecap","round").attr("d",a=>{const c={x:u.x0,y:u.y0};return L({source:c,target:c})}),Y.each(function(a){const c=E(this),_=a.target.data.availability;let m=o.public;_==="both"?m=o.both:_==="restricted"&&(m=o.restricted),c.append("path").attr("class","link-overlay").attr("fill","none").attr("stroke",m).attr("stroke-width",rt).attr("opacity",.6).attr("stroke-linecap","round").attr("d",()=>{const k={x:u.x0,y:u.y0};return L({source:k,target:k})})});const K=Y.merge(O);K.select(".link-base").transition().duration(600).attr("d",L),K.select(".link-overlay").transition().duration(600).attr("d",L),O.exit().transition().duration(600).attr("opacity",0).remove();const G=F.selectAll(".node").data(T,a=>a.data.title),I=G.enter().append("g").attr("class","node").attr("transform",()=>`translate(${u.x0},${u.y0})`).on("click",(a,c)=>{var _;a.stopPropagation(),(c.children||c._children)&&(!c.children&&c._children&&c.parent&&((_=c.parent.children)==null||_.forEach(k=>{k!==c&&k.children&&(k._children=k.children,k.children=null)})),c.children?(c._children=c.children,c.children=null):(c.children=c._children,c._children=null),q(c))}).on("mouseenter",function(a,c){if(c.data.description||c.data.details){const m=E(this).select("circle").node().getBoundingClientRect();x({visible:!0,content:c.data,x:m.left+m.width/2,y:m.top})}E(this).select("circle").transition().duration(200).attr("r",w*1.3)}).on("mouseleave",function(a,c){x({visible:!1,content:null,x:0,y:0}),E(this).select("circle").transition().duration(200).attr("r",w)});I.each(function(a,c){const _=E(this),m=a.data.availability,k=a.data.category&&a.depth>0,R=a.depth===0;let A=o.public;R?A=o.root:m==="both"?A=o.both:m==="restricted"?A=o.restricted:k&&(A=o.category),_.append("circle").attr("r",w).attr("fill",A).attr("stroke","#FBE9D0").attr("stroke-width",2.5).style("cursor",a.children||a._children?"pointer":"default").style("filter","drop-shadow(0 4px 8px rgba(0, 0, 0, 0.2))"),(a._children||a.children)&&_.append("text").attr("class","node-indicator").attr("text-anchor","middle").attr("dy","0.35em").attr("fill","#FBE9D0").attr("font-size",`${w*1.2}px`).attr("font-weight","bold").style("pointer-events","none").text(a._children?"+":"−")}),I.each(function(a){const c=E(this),_=a.data.category&&a.depth>0,m=a.depth===0?18:_?N:y,k=w+25,R=c.append("text").attr("y",k).attr("text-anchor","middle").attr("font-family","system-ui, -apple-system, sans-serif").attr("font-size",`${m}px`).attr("font-weight",a.depth===0?"700":_?"600":"500").attr("fill","#1e293b").style("pointer-events","none"),A=a.data.title.split(/\s+/),it=d?120:f?140:160,U=[];let j=A[0];for(let S=1;S<A.length;S++){const M=j+" "+A[S];R.text(M),R.node().getComputedTextLength()>it?(U.push(j),j=A[S]):j=M}U.push(j),R.remove(),U.forEach((S,M)=>{c.append("text").attr("y",k+M*(m+2)).attr("text-anchor","middle").attr("font-family","Montserrat, system-ui, sans-serif").attr("font-size",`${m}px`).attr("font-weight",a.depth===0?"700":_?"600":"500").attr("fill","#244855").style("pointer-events","none").text(S).style("paint-order","stroke").style("stroke","#FBE9D0").style("stroke-width",d?"3px":"4px").style("stroke-linecap","round").style("stroke-linejoin","round")})});const Q=I.merge(G);Q.transition().duration(600).attr("transform",a=>`translate(${a.x},${a.y})`),Q.select(".node-indicator").text(a=>a._children?"+":"−"),G.exit().transition().duration(600).attr("transform",()=>`translate(${u.x},${u.y})`).remove(),T.forEach(a=>{a.x0=a.x,a.y0=a.y})}function L(u){return`M${u.source.x},${u.source.y} C${u.source.x},${(u.source.y+u.target.y)/2} ${u.target.x},${(u.source.y+u.target.y)/2} ${u.target.x},${u.target.y}`}q(B),z.on("click",()=>{x({visible:!1,content:null,x:0,y:0})})},[t,p,l]),C.jsxs("div",{ref:g,className:`data-coverage-tree ${s}`,children:[C.jsx("svg",{ref:h}),r.visible&&r.content&&C.jsxs("div",{className:"data-coverage-tree__tooltip",style:{left:`${r.x}px`,top:`${r.y-10}px`,transform:"translate(-50%, -100%)"},children:[C.jsx("div",{className:"data-coverage-tree__tooltip-title",children:r.content.title}),r.content.description&&C.jsx("div",{className:"data-coverage-tree__tooltip-description",children:r.content.description}),r.content.details&&C.jsx("div",{className:"data-coverage-tree__tooltip-details",children:r.content.details})]})]})}export{Tt as D};
