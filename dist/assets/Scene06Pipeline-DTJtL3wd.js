import{r as U,a as L,j as M}from"./index-DisIoiRj.js";import{b as st}from"./back-BxPoHLz2.js";import{u as nt}from"./useResizeObserver-IvLdvs2c.js";const ot=s=>+s,D=Math.PI,j=2*D,v=1e-6,lt=j-v;function X(s){this._+=s[0];for(let t=1,e=s.length;t<e;++t)this._+=arguments[t]+s[t]}function ct(s){let t=Math.floor(s);if(!(t>=0))throw new Error(`invalid digits: ${s}`);if(t>15)return X;const e=10**t;return function(a){this._+=a[0];for(let r=1,n=a.length;r<n;++r)this._+=Math.round(arguments[r]*e)/e+a[r]}}class Z{constructor(t){this._x0=this._y0=this._x1=this._y1=null,this._="",this._append=t==null?X:ct(t)}moveTo(t,e){this._append`M${this._x0=this._x1=+t},${this._y0=this._y1=+e}`}closePath(){this._x1!==null&&(this._x1=this._x0,this._y1=this._y0,this._append`Z`)}lineTo(t,e){this._append`L${this._x1=+t},${this._y1=+e}`}quadraticCurveTo(t,e,a,r){this._append`Q${+t},${+e},${this._x1=+a},${this._y1=+r}`}bezierCurveTo(t,e,a,r,n,h){this._append`C${+t},${+e},${+a},${+r},${this._x1=+n},${this._y1=+h}`}arcTo(t,e,a,r,n){if(t=+t,e=+e,a=+a,r=+r,n=+n,n<0)throw new Error(`negative radius: ${n}`);let h=this._x1,g=this._y1,y=a-t,c=r-e,p=h-t,l=g-e,o=p*p+l*l;if(this._x1===null)this._append`M${this._x1=t},${this._y1=e}`;else if(o>v)if(!(Math.abs(l*y-c*p)>v)||!n)this._append`L${this._x1=t},${this._y1=e}`;else{let $=a-h,x=r-g,H=y*y+c*c,z=$*$+x*x,k=Math.sqrt(H),T=Math.sqrt(o),A=n*Math.tan((D-Math.acos((H+o-z)/(2*k*T)))/2),_=A/T,w=A/k;Math.abs(_-1)>v&&this._append`L${t+_*p},${e+_*l}`,this._append`A${n},${n},0,0,${+(l*$>p*x)},${this._x1=t+w*y},${this._y1=e+w*c}`}}arc(t,e,a,r,n,h){if(t=+t,e=+e,a=+a,h=!!h,a<0)throw new Error(`negative radius: ${a}`);let g=a*Math.cos(r),y=a*Math.sin(r),c=t+g,p=e+y,l=1^h,o=h?r-n:n-r;this._x1===null?this._append`M${c},${p}`:(Math.abs(this._x1-c)>v||Math.abs(this._y1-p)>v)&&this._append`L${c},${p}`,a&&(o<0&&(o=o%j+j),o>lt?this._append`A${a},${a},0,1,${l},${t-g},${e-y}A${a},${a},0,1,${l},${this._x1=c},${this._y1=p}`:o>v&&this._append`A${a},${a},0,${+(o>=D)},${l},${this._x1=t+a*Math.cos(n)},${this._y1=e+a*Math.sin(n)}`)}rect(t,e,a,r){this._append`M${this._x0=this._x1=+t},${this._y0=this._y1=+e}h${a=+a}v${+r}h${-a}Z`}toString(){return this._}}function K(){return new Z}K.prototype=Z.prototype;const ht={completed:{primary:"#10b981",bg:"#ecfdf5"},active:{primary:"#3b82f6",bg:"#eff6ff"},pending:{primary:"#94a3b8",bg:"#f8fafc"},default:{primary:"#6366f1",bg:"#eef2ff"}};function pt({stages:s,width:t=1200,height:e=580,title:a="Data Collection Pipeline",statusColors:r,className:n=""}){const h=U.useRef(null),g={...ht,...r},y=c=>g[c??"default"]??g.default;return U.useEffect(()=>{if(!h.current||s.length===0)return;const c=L(h.current);c.selectAll("*").remove();const p=[],l={top:80,right:65,bottom:70,left:65},o=t-l.left-l.right,$=e-l.top-l.bottom,x=c.append("g").attr("transform",`translate(${l.left},${l.top})`);c.append("defs").append("filter").attr("id","node-shadow").attr("x","-40%").attr("y","-40%").attr("width","180%").attr("height","180%").append("feDropShadow").attr("dx",0).attr("dy",4).attr("stdDeviation",7).attr("flood-color","rgba(0,0,0,0.14)");const k="#5b8dd9",T="#3a6bb5",A="#a8c7f0",_=46,w=20,O=Math.min(42,Math.max(30,Math.min(o/(s.length*5),$*.11))),I=$*.3,W=$*.7,R=$*.5,q=o*.15,N=_/2+O+14,Y=s.map((i,u)=>{const m=s.length>1?q+u/(s.length-1)*(o-2*q):o/2,d=u%2===0,b=d?I:W,f=!d,P=d?I+N:W-N;return{...i,x:m,y:P,pathY:b,radius:O,index:u,isTop:f}}),J=w+8,tt=o-w-8,S=[[J,R],...Y.map(i=>[i.x,i.pathY]),[tt,R]],E=K();E.moveTo(S[0][0],S[0][1]);for(let i=0;i<S.length-1;i++){const[u,m]=S[i],[d,b]=S[i+1],f=u+(d-u)*.5;E.bezierCurveTo(f,m,f,b,d,b)}const C=E.toString();x.append("path").attr("d",C).attr("stroke",T).attr("stroke-width",_+10).attr("fill","none").attr("stroke-linecap","round").attr("opacity",.18),x.append("path").attr("d",C).attr("stroke",A).attr("stroke-width",_-24).attr("fill","none").attr("stroke-linecap","round").attr("opacity",.55).attr("transform","translate(0,-7)");const F=x.append("path").attr("d",C).attr("stroke",k).attr("stroke-width",_).attr("fill","none").attr("stroke-linecap","round");x.append("path").attr("d",C).attr("stroke","rgba(255,255,255,0.35)").attr("stroke-width",3).attr("fill","none").attr("stroke-dasharray","14 30").attr("class","snake-flow-anim"),[{x:0,y:R},{x:o,y:R}].forEach(({x:i,y:u})=>{const m=x.append("g").attr("transform",`translate(${i},${u})`);m.append("circle").attr("r",w).attr("fill",k).attr("stroke","white").attr("stroke-width",3),m.append("text").attr("text-anchor","middle").attr("dy","0.35em").attr("fill","white").attr("font-size","16px").attr("font-weight","bold").text("‚Üí")});const G=2e3;Y.forEach((i,u)=>{const m=y(i.status),d=i.radius,b=i.isTop?-1:1,f=x.append("g").attr("transform",`translate(${i.x},${i.y})`).attr("opacity",0).attr("cursor","pointer"),P=i.pathY-i.y,et=i.isTop?i.radius:-i.radius;f.append("line").attr("x1",0).attr("y1",et).attr("x2",0).attr("y2",P).attr("stroke",m.primary).attr("stroke-width",2).attr("opacity",.5),f.append("circle").attr("r",d).attr("fill","white").attr("stroke",m.primary).attr("stroke-width",4).attr("filter","url(#node-shadow)"),f.append("text").attr("text-anchor","middle").attr("dy","0.35em").attr("font-size",`${Math.round(d*.72)}px`).text(i.icon);const B=f.append("g").attr("transform",`translate(${d*.67},${-d*.67})`);B.append("circle").attr("r",11).attr("fill",m.primary).attr("stroke","white").attr("stroke-width",2),B.append("text").attr("text-anchor","middle").attr("y",4).attr("fill","white").attr("font-size","10px").attr("font-weight","bold").text(u+1),f.append("text").attr("y",b*(d+16)).attr("text-anchor","middle").attr("fill",m.primary).attr("font-size","13px").attr("font-weight","700").attr("dominant-baseline",i.isTop?"auto":"hanging").text(i.title),i.metrics&&i.metrics.forEach((Q,rt)=>{f.append("text").attr("y",b*(d+32+rt*15)).attr("text-anchor","middle").attr("fill","#64748b").attr("font-size","11px").attr("dominant-baseline",i.isTop?"auto":"hanging").text(`${Q.value} ¬∑ ${Q.label}`)}),f.on("mouseenter",function(){L(this).transition().duration(180).attr("transform",`translate(${i.x},${i.y}) scale(1.1)`)}).on("mouseleave",function(){L(this).transition().duration(180).attr("transform",`translate(${i.x},${i.y}) scale(1)`)});const at=G*(u+1)/(s.length+1),it=setTimeout(()=>{f.transition().duration(460).ease(st.overshoot(1.3)).attr("opacity",1)},at);p.push(it)});const V=F.node().getTotalLength();return F.attr("stroke-dasharray",V).attr("stroke-dashoffset",V).transition().duration(G).ease(ot).attr("stroke-dashoffset",0),()=>{p.forEach(i=>clearTimeout(i))}},[s,t,e,a]),M.jsx("div",{className:`pipeline-flow-d3 ${n}`,style:{width:"100%",display:"flex",justifyContent:"center",alignItems:"center"},children:M.jsx("svg",{ref:h,width:t,height:e,viewBox:`0 0 ${t} ${e}`,preserveAspectRatio:"xMidYMid meet",style:{display:"block",margin:"0 auto",maxWidth:"100%",height:"auto"}})})}const dt=[{id:"recruit",title:"Recruitment",description:"NAMCS field representatives identify and contact health centers that meet eligibility criteria for EHR-based electronic data submission.",icon:"üë•",status:"completed",metrics:[{value:"150+",label:"Centers Contacted"},{value:"~95%",label:"Response Rate"}]},{id:"questionnaire",title:"Site Assessment",description:"Health centers complete a structured questionnaire covering their EHR system type, patient visit volume, and technical infrastructure.",icon:"üìã",status:"completed",metrics:[{value:"25+",label:"Data Points"},{value:"24 hrs",label:"Avg Completion"}]},{id:"install",title:"HL7 Integration",description:"NAMCS technical staff deploy HL7 FHIR-compatible extraction scripts configured for the center's specific EHR system.",icon:"‚öôÔ∏è",status:"active",metrics:[{value:"12",label:"EHR Systems"},{value:"~48 hrs",label:"Setup Time"}]},{id:"test",title:"Quality Validation",description:"Extracted records undergo automated and manual review for completeness, coding accuracy, and compliance with NAMCS data specifications.",icon:"üß™",status:"pending",metrics:[{value:"99%+",label:"Accuracy Target"},{value:"2‚Äì3 days",label:"Validation Window"}]},{id:"submit",title:"Production",description:"Validated health centers submit encounter data monthly to NCHS through automated, secure data pipelines.",icon:"üì§",status:"pending",metrics:[{value:"Monthly",label:"Reporting Cycle"},{value:"Automated",label:"Data Flow"}]}],ft=dt;function gt(){const{ref:s,rect:t}=nt(),e=Math.max(800,Math.min(1400,t.width-40)),a=Math.max(360,Math.min(480,t.height-100));return M.jsxs("div",{ref:s,style:{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",height:"100vh",overflow:"hidden",background:"linear-gradient(135deg, #f0f4ff 0%, #dce8f5 100%)",padding:"20px",boxSizing:"border-box",width:"100%",gap:"16px"},children:[M.jsx("h2",{style:{margin:0,fontSize:"26px",fontWeight:800,color:"#1e293b",fontFamily:"system-ui, -apple-system, sans-serif",letterSpacing:"-0.3px",flexShrink:0},children:"Data Collection Pipeline"}),M.jsx("p",{style:{margin:0,fontSize:"14px",color:"#475569",textAlign:"center",maxWidth:"680px",lineHeight:1.65,flexShrink:0},children:"Health centers join NAMCS through a five-stage process that ensures data quality before electronic records enter the research pipeline‚Äîfrom initial recruitment through HL7 software installation, validation testing, and final submission."}),M.jsx(pt,{stages:ft,width:e,height:a})]})}export{gt as default};
